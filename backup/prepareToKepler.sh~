#!/bin/bash

FILE="$1"
NEW_FILE=0
COMPRESSED_FILE="inputs.zip"

ls -l

echo "Starting with file: $FILE $@"
if [ -e "$FILE" ]; then
	echo "Existing file, renaming to $NEW_FILE"
	mv "$FILE" "$NEW_FILE"

	if [ -e "$NEW_FILE" ]; then
		echo "Renaming completed, creating tree"

		for i in 0 1 2 3 4 5 6; do
			mkdir -p "result/images/$i"
			cp "$NEW_FILE" "result/images/$i"
		done

		echo "End of creation, displaying the tree"
		ls -R

		echo "Compressing data"
		zip -r $COMPRESSED_FILE result/

		if [ -e "$COMPRESSED_FILE" ]; then
			echo "Workflow correctly executed"
			exit 0
		fi
	fi
fi

echo "Problem during workflow execution"
exit 1
